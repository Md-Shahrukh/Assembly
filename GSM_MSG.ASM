		ORG 	00H
		SJMP	Q1
		ORG		0023H
		MOV		A,SBUF
		MOV		@R1,A
		INC		R1
		CLR		RI
		INC		R3
		RETI	

Q1:		MOV		DPTR,#COMMAND
		CLR 	A
Q12:	MOVC	A,@A+DPTR
		JZ		Q13
		ACALL	CMD
		INC		DPTR
		CLR		A
		SJMP	Q12
Q13:	MOV		R1,#30H
		MOV		DPTR,#GSM1
Q11:	MOVC	A,@A+DPTR
		JZ		Q2
		MOV		SBUF,A
		ACALL	X2
		INC		DPTR
		CLR		A
		SJMP	Q11
Q2:		MOV		IE,#10010000B
		CJNE	R3,#0FH,Q3
		MOV		IE,#00H
		MOV		R1,#30H
Q22:	MOV		A,@R1
		INC		R1
		ACALL	DAT
		CLR		A
		DJNZ	R3,Q22

Q3:		MOV		R1,#50H
		MOV		DPTR,#GSM2
Q33:	MOVC	A,@A+DPTR
		JZ		Q4
		MOV		SBUF,A
		ACALL	X2
		INC		DPTR
		CLR		A
		SJMP	Q33

Q4:		MOV		DPTR,#GSM3
Q44:	MOVC	A,@A+DPTR
		JZ		Q5
		MOV		SBUF,A
		ACALL	X2
		INC		DPTR
		CLR		A
		SJMP	Q44
Q5:		SJMP 	$

CMD: 	MOV 	P2,A
		CLR 	P0.0
		CLR 	P0.1
		SETB 	P0.2
		ACALL 	DELAY
		CLR		P0.2
		RET		
	
DAT:	MOV 	P2,A
		SETB 	P0.0
		CLR 	P0.1
		SETB 	P0.2
		ACALL 	DELAY
		CLR 	P0.2
		RET
				
		
DELAY: 	MOV 	R0,#20
Z1:		MOV 	R2,#200
Z2:		DJNZ 	R2,Z2
		DJNZ 	R0,Z1
		RET
			
		
X2:		JNB		TI,X2
		CLR		TI
		RET
		
		 ORG		250H
COMMAND: DB 	38H,0EH,80H,01H,06H,0
GSM1:	 DB 	"AT+CMGF=1",0DH,0
GSM2:	 DB		"AT+CMGS=",22H,"8908849462",22H,0
GSM3:	 DB		"EMBEDDED SYSTEMS",1AH,0
		end